@page
@using BillSharing.Localization
@using Microsoft.Extensions.Localization
@using Volo.Abp.AspNetCore.Mvc.UI.Bootstrap.TagHelpers.Modal
@inject IStringLocalizer<BillSharingResource> L
@model BillSharing.Web.Pages.Groups.IndexModel

@section scripts
{
    <abp-script src="/Pages/Groups/Index.js" />
}

<div class="group-section">
    <abp-card-header>
        <abp-row>
            <abp-column size-md="_6">
                <h2>@L["Menu:Groups"]</h2>
            </abp-column>

            <abp-column size-md="_6" class="text-end">
                <abp-button button-type="Outline_Primary"
                            icon="sign-in-alt"
                            class="me-2"
                            data-bs-toggle="modal"
                            data-bs-target="#JoinGroupModal">
                    @L["Group:JoinGroup"]
                </abp-button>

                <abp-button button-type="Primary"
                            icon="plus"
                            data-bs-toggle="modal"
                            data-bs-target="#CreateGroupModal">
                    @L["Group:NewGroup"]
                </abp-button>
            </abp-column>
        </abp-row>
    </abp-card-header>

    <abp-card-body>

        <div class="row">

            @foreach (var group in Model.Groups)
            {
                <div class="col-md-4 my-3">

                    <div class="card mb-4 shadow-sm h-100 group-card"
                         data-url="/Groups/Details/@group.Id"
                         style="cursor:pointer;">

                        <div class="card-body">

                            <!-- Header: Name + Edit Icon -->
                            <div class="d-flex justify-content-between align-items-start">

                                <h5 class="card-title mb-1 group-name">
                                    @group.Name
                                </h5>

                                <div>
                                    <button class="btn btn-sm btn-light edit-btn"
                                            data-id="@group.Id"
                                            data-mode="edit">
                                        <i class="fa fa-pen"></i>
                                    </button>
                                </div>
                            </div>

                            <!-- Description -->
                            <p class="card-text text-muted mt-2 group-description" data-id="@group.Id">
                                @group.Description
                            </p>

                            <!-- Member Count -->
                            <span class="badge bg-info mb-2">
                                @group.MemberCount @L["Group:Members"]
                            </span>

                            <!-- Invite Code -->
                            @if (!string.IsNullOrEmpty(group.InviteCode))
                            {
                                <div class="mt-2">

                                    <small class="text-muted">@L["Group:InviteCode"]</small>

                                    <div class="input-group input-group-sm mt-1"
                                         onclick="event.stopPropagation();">

                                        <input type="text"
                                               class="form-control invite-code-input"
                                               value="@group.InviteCode"
                                               readonly />

                                        <button class="btn btn-outline-secondary copy-btn"
                                                type="button"
                                                data-code="@group.InviteCode">
                                            <i class="fa fa-copy"></i>
                                        </button>

                                        <button class="btn btn-outline-primary share-btn"
                                                type="button"
                                                data-code="@group.InviteCode"
                                                data-group="@group.Name">
                                            <i class="fa fa-share-alt"></i>
                                        </button>

                                    </div>

                                </div>
                            }

                        </div>
                    </div>

                </div>
            }

        </div>

    </abp-card-body>
</div>
<abp-modal id="CreateGroupModal" centered="true">
    <abp-modal-header title="@L["Group:NewGroup"]"></abp-modal-header>

    <abp-modal-body>

        <form id="CreateGroupForm">

            <div class="mb-3">
                <label class="form-label">@L["Group:GroupName"]</label>
                <input type="text"
                       class="form-control"
                       name="Name"
                       required />
            </div>

            <div class="mb-3">
                <label class="form-label">@L["Group:Description"]</label>
                <textarea class="form-control"
                          name="Description"
                          rows="3"></textarea>
            </div>

        </form>

    </abp-modal-body>

    <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">@L["Cancel"]</button>
        <button type="button" class="btn btn-primary">@L["Save"]</button>
    </div>
</abp-modal>
<abp-modal id="JoinGroupModal" centered="true">
    <abp-modal-header title="@L["Group:JoinGroup"]"></abp-modal-header>
    <abp-modal-body>
        <form id="JoinGroupForm">
            <div class="mb-3">
                <label class="form-label">@L["Group:InviteCode"]</label>
                <input type="text"
                       id="JoinInviteCode"
                       class="form-control"
                       placeholder="@L["Group:InviteCodePlaceholder"]"
                       maxlength="8"
                       required />
            </div>
        </form>
    </abp-modal-body>
    <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">@L["Cancel"]</button>
        <button type="button" class="btn btn-primary">@L["Save"]</button>
    </div>
</abp-modal>